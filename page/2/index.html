<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Keep moving. Don&apos;t settle.">
<meta property="og:type" content="website">
<meta property="og:title" content="Coco">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Coco">
<meta property="og:description" content="Keep moving. Don&apos;t settle.">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Coco">
<meta name="twitter:description" content="Keep moving. Don&apos;t settle.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>Coco</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Coco</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Hello world</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/25/Android源码设计模式解析与实战----责任链模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ke Yu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coco">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/25/Android源码设计模式解析与实战----责任链模式/" itemprop="url">Android源码设计模式解析与实战----责任链模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-25T15:31:14+08:00">
                2017-10-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/25/TensorFlow在Android上的构建/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ke Yu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coco">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/25/TensorFlow在Android上的构建/" itemprop="url">Tensorflow在Android上的搭建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-25T15:31:14+08:00">
                2017-10-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI/" itemprop="url" rel="index">
                    <span itemprop="name">AI</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="第一个坑"><a href="#第一个坑" class="headerlink" title="第一个坑"></a>第一个坑</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">android_sdk_repository(</span><br><span class="line">    name = &quot;androidsdk&quot;,</span><br><span class="line">    api_level = 24,</span><br><span class="line">#    # Ensure that you have the build_tools_version below installed in the</span><br><span class="line">#    # SDK manager as it updates periodically.</span><br><span class="line">    build_tools_version = &quot;23.0.2&quot;,</span><br><span class="line">#    # Replace with path to Android SDK on your system</span><br><span class="line">    path = &quot;/home/kk/Pictures/SDKK/android-sdk-linux/&quot;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>注意在取消注释时，最后一个括号前面的‘#’也要去掉。</p>
<h3 id="sdk安装"><a href="#sdk安装" class="headerlink" title="sdk安装"></a>sdk安装</h3><p>一直提示WORKSPACE里面的android_sdk_reporitory有错，提示我应该安装sdk，但是我有将sdk安装包解压，build-tools等也进行了解压，并且设置了正确的path，所以一直没考虑到sdk的安装问题，一直以为是不是路径写错了，因为error最后提示到了“Referenced by /‘external/sdk’”类似的字样，所以google(最近被墙的很严重，勉强能用stackoverflow),baidu了很久，把<a href="https://docs.bazel.build/versions/master/tutorial/android-app.html中相关内容看了一遍，还是没找到原因。" target="_blank" rel="noopener">https://docs.bazel.build/versions/master/tutorial/android-app.html中相关内容看了一遍，还是没找到原因。</a><br>后来突然想到会不会真是sdk安装的原因？后来查了一下sdk在Linux上的安装方法，果然有一些问题。<br>解压完sdk包后，进入tools文件夹，用android命令安装sdk,build-tools等工具（其实感觉更像是更新），这样操作后，总算过了这个error。<br>所以实际原因就是sdk的安装不对。</p>
<h3 id="CMakeList-txt"><a href="#CMakeList-txt" class="headerlink" title="CMakeList.txt"></a>CMakeList.txt</h3><pre><code>* 编写了CMake的语句
* 通过CMake语句指向这个.txt所在目录可以生成makefile文件

通过tensorflow_demo的CmakeList.txt文件，分析一下语法：
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">project(TENSORFLOW_DEMO) # 工程名</span><br><span class="line"></span><br><span class="line">#最低版本要求3.4.1，否则不能构建</span><br><span class="line">cmake_minimum_required(VERSION 3.4.1)</span><br><span class="line"></span><br><span class="line">#设置makefile为开启</span><br><span class="line">set(CMAKE_VERBOSE_MAKEFILE on)</span><br><span class="line"></span><br><span class="line"># 得到这个完整文件名的完整路径</span><br><span class="line"># get_filename_component 得到一个完整文件名中的特定部分。</span><br><span class="line"># get_filename_component(&lt;VAR&gt; FileName</span><br><span class="line">                         PATH|ABSOLUTE|NAME|EXT|NAME_WE|REALPATH</span><br><span class="line">                         [CACHE])</span><br><span class="line">#　　将变量#&lt;VAR&gt;设置为路径(PATH)，文件名(NAME)，文件扩展名(EXT)，去掉扩#展名的文件名(NAME_WE)，完整路径(ABSOLUTE)，或者所有符号链接被解析出的完#整路径(REALPATH)。</span><br><span class="line">　　</span><br><span class="line">get_filename_component(TF_SRC_ROOT $&#123;CMAKE_SOURCE_DIR&#125;/../../../..  ABSOLUTE)</span><br><span class="line">get_filename_component(SAMPLE_SRC_DIR  $&#123;CMAKE_SOURCE_DIR&#125;/..  ABSOLUTE)</span><br><span class="line"></span><br><span class="line">if (ANDROID_ABI MATCHES &quot;^armeabi-v7a$&quot;)</span><br><span class="line">    set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -mfloat-abi=softfp -mfpu=neon&quot;)</span><br><span class="line">elseif(ANDROID_ABI MATCHES &quot;^arm64-v8a&quot;)</span><br><span class="line">    set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -O2 -ftree-vectorize&quot;)</span><br><span class="line">endif()</span><br><span class="line"></span><br><span class="line">set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -DSTANDALONE_DEMO_LIB \</span><br><span class="line">                    -std=c++11 -fno-exceptions -fno-rtti -O2 -Wno-narrowing \</span><br><span class="line">                    -fPIE&quot;)</span><br><span class="line">set(CMAKE_SHARED_LINKER_FLAGS &quot;$&#123;CMAKE_SHARED_LINKER_FLAGS&#125; \</span><br><span class="line">                              -Wl,--allow-multiple-definition \</span><br><span class="line">                              -Wl,--whole-archive -fPIE -v&quot;)</span><br><span class="line"></span><br><span class="line">file(GLOB_RECURSE tensorflow_demo_sources $&#123;SAMPLE_SRC_DIR&#125;/jni/*.*)</span><br><span class="line">add_library(tensorflow_demo SHARED</span><br><span class="line">            $&#123;tensorflow_demo_sources&#125;)</span><br><span class="line">target_include_directories(tensorflow_demo PRIVATE</span><br><span class="line">                           $&#123;TF_SRC_ROOT&#125;</span><br><span class="line">                           $&#123;CMAKE_SOURCE_DIR&#125;)</span><br><span class="line"># 执行文件tensorflow_demo依赖的子目录生成的库名字：android,log.....</span><br><span class="line">target_link_libraries(tensorflow_demo</span><br><span class="line">                      android</span><br><span class="line">                      log</span><br><span class="line">                      jnigraphics</span><br><span class="line">                      m</span><br><span class="line">                      atomic</span><br><span class="line">                      z)</span><br></pre></td></tr></table></figure>
<h3 id="Can’t-find-lt-android-log-h-gt"><a href="#Can’t-find-lt-android-log-h-gt" class="headerlink" title="Can’t find &lt;android/log.h&gt;"></a>Can’t find &lt;android/log.h&gt;</h3><p><img src="http://ovwunej09.bkt.clouddn.com/TF01_1.png" alt=""></p>
<ul>
<li>差点忘记了include的用法，本来第一反应android/log.h是路径，然后去上一级android文件夹里看了下….并没有log.h这个文件，又搜索看了下include的用法，发现include应该是搜索系统的一些路径。同时，JNI文件的include查找的是NDK的路径，发现自己还没有设置NDK的环境变量，设置了，问题解决。</li>
</ul>
<h3 id="kernels-svd-op-failed"><a href="#kernels-svd-op-failed" class="headerlink" title="kernels:svd_op,failed"></a>kernels:svd_op,failed</h3><p><img src="http://ovwunej09.bkt.clouddn.com/tf01_5.png" alt=""><br>这个问题有人遇到过，error exit 4的错误，内存空间不足<br><a href="http://blog.csdn.net/cq361106306/article/details/52929468" target="_blank" rel="noopener">http://blog.csdn.net/cq361106306/article/details/52929468</a><br>这里找到两个解决方案</p>
<ul>
<li>命令增加–local_resources 2048,.5,1.0</li>
<li>tensorflow的kernel出现了问题，然后有点怀疑是tensorflow的安装出了问题。<br>于是又找了一个tensorflow源码安装的教程，补充了一些依赖的安装。<blockquote>
<p>sudo apt-get install python-numpy swig python-dev</p>
<p>sudo apt-get install python-numpy python-dev python-pip python-wheel</p>
</blockquote>
</li>
</ul>
<h3 id="‘-aws-aws’-failed"><a href="#‘-aws-aws’-failed" class="headerlink" title="‘@aws//:aws’ failed"></a>‘@aws//:aws’ failed</h3><p>又是一个C++ compilation rule的错误，去到提示的文件README.Bugs中没什么发现，</p>
<p>bazel build -c opt –spawn_strategy=standalone –verbose_failures –local_resources 2048,.5,1.0 //tensorflow/tools/pip_package:build_pip_package</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/24/车辆检测2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ke Yu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coco">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/24/车辆检测2/" itemprop="url">车辆检测论文（2）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-24T20:03:13+08:00">
                2017-10-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/图像/" itemprop="url" rel="index">
                    <span itemprop="name">图像</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>2017年</p>
<h4 id="Adaptive-ViBe-background-model-for-vehicle-detection"><a href="#Adaptive-ViBe-background-model-for-vehicle-detection" class="headerlink" title="Adaptive ViBe background model for vehicle detection"></a>Adaptive ViBe background model for vehicle detection</h4><p>BY 东南大学的好几个人</p>
<p>这和刚才那篇架构，也太像了吧….</p>
<h4 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h4><p>在实际应用中，光照变化会引起背景的巨大变化，所以需要对这个背景建模算法（ViBe）进行改进。</p>
<ul>
<li>一是定义两种车辆检测的误差和误差方程；</li>
<li>二是根据这两种误差的范围，定义合理的评估环境来调整不合理的阙值（用来保证这个模型的改进之处）；</li>
<li>三是实际场景下的实验体现了改进的ViBe模型相比高斯模型、codeback模型和固定阙值的ViBe模型有更好的车辆检测准确度；</li>
</ul>
<h4 id="文章结构"><a href="#文章结构" class="headerlink" title="文章结构"></a>文章结构</h4><ul>
<li>一 介绍</li>
<li>二 ViBe 模型介绍<br>  ViBe 模型的初始化；<br>  车辆检测；<br>  模型改进；</li>
<li>三 自适应ViBe模型<br>  分析ViBe模型<br>  定义车辆检测误差方程<pre><code>帧差的二值化
两种误差方程
</code></pre>  自适应阙值调整</li>
<li>四 测试结果</li>
<li>五 结论</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/24/车辆检测1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ke Yu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coco">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/24/车辆检测1/" itemprop="url">车辆检测论文（1）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-24T18:15:54+08:00">
                2017-10-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/图像/" itemprop="url" rel="index">
                    <span itemprop="name">图像</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="A-vehicle-detection-method-in-tunnel-video-based-on-ViBe-algorithm"><a href="#A-vehicle-detection-method-in-tunnel-video-based-on-ViBe-algorithm" class="headerlink" title="A vehicle detection method in tunnel video based on ViBe algorithm"></a>A vehicle detection method in tunnel video based on ViBe algorithm</h4><p> BY 武大 Zhu Qiming Ma ChengQian</p>
<h4 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h4><p>在隧道视频中的车辆检测，基于ViBe（Visual Background Extraction 一种目标检测）算法，主要包括三步：</p>
<ul>
<li>一是对视频进行直方图均衡化，提高视频图像的质量；</li>
<li>二是调节ViBe算法根据背景建模并且检测移动的车辆；</li>
<li>三是用形态滤波器去除检测结果的噪点。</li>
</ul>
<h4 id="文章结构"><a href="#文章结构" class="headerlink" title="文章结构"></a>文章结构</h4><ul>
<li>一 介绍</li>
<li>二 ViBe建模算法介绍<br>  公式，流程等。</li>
<li>三 隧道车辆检测方法<br>  按照Abstract中的步骤进行叙述</li>
<li>四 实验结果</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/24/车辆检测10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ke Yu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coco">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/24/车辆检测10/" itemprop="url">车辆检测论文（8）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-24T15:41:12+08:00">
                2017-10-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/图像/" itemprop="url" rel="index">
                    <span itemprop="name">图像</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Vehicle Detection by a Context-Aware<br>Multichannel Feature Pyramid</p>
<h4 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h4><p>现有的appearance-based车辆检测方法主要都是运用特征算子进行检测，比如Haar-like,方向梯度直方图，尺度变化特征转换等等。然而，当需要处理光照、缩放、形态变化和复杂的背景时，这些局部特征都有局限性。现在需要一种有辨别性和鲁棒性的特征。为了实习这个目的，本文提出了一个新奇的使用上下文感知多通道特征金字塔的算法。本文主要贡献是提出两种上下文感知的结构描述子，这两种描述子分别被叫做context-aware difference sign transform feature和context-aware difference magnitude transform feature。 图片被置于cell的稠密网格中，每个cell都由局部细节和上下文感知结构描述子描述。这个描述子可以捕捉到这些cells的上下文感知结构信息。该特征金字塔可以为车辆检测提供更高效的特征。使用两个公共交通数据集进行的实验体现这个方法相比state-of-the-art方法有更高的性能。更重要的是，即便是车辆出现了形态变化或者相机视点改变，该实验结果也很令人满意。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/24/车辆检测9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ke Yu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coco">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/24/车辆检测9/" itemprop="url">车辆检测论文（7）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-24T15:23:54+08:00">
                2017-10-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/图像/" itemprop="url" rel="index">
                    <span itemprop="name">图像</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Efficient L-Shape Fitting for Vehicle Detection Using Laser Scanners BY Xiao Zhang, Wenda Xu, Chiyu Dong and John M. Dolan<br>2017</p>
<h4 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h4><p>自动驾驶中，周围汽车的检测是一项重要的任务，最近引起了广泛的关注。当使用雷达扫描器时，L-Shape装置是基于模型的车辆检测和追踪的关键步骤，需要彻底的调查和综合的研究。在本篇论文中，我们将L-shape装置公式化为一个最优问题，寻找这个最优解的方法被提出。我们的方法不依赖于雷达扫描序列信息，并且支持多雷达扫描器的便捷数据融合。这非常的高效，并且几乎不涉及通信参数。同时此方法非常的灵活，可以适用于多种多样的条件不同的装置。使用产品分数的雷达扫描器的路上实验显示了这个方法的有效性和鲁棒性。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/24/车辆检测6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ke Yu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coco">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/24/车辆检测6/" itemprop="url">车辆检测论文（6）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-24T14:33:23+08:00">
                2017-10-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/图像/" itemprop="url" rel="index">
                    <span itemprop="name">图像</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Automated Vehicle Detection Using Optical Fiber<br>Communication<br>BY Samarth Gupta ， Professor Vikas Upadhyaya<br>Electronics and Communication Department NIIT University<br>Neemrana, India</p>
<h4 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h4><p>汽车自动探测是很有挑战性的领域，由于复杂的交通情况，交通监控系统检测更复杂更有挑战性。在本次研究中，我们探索到光纤技术可以用于负荷传感器来测量车辆以普通速度前进时的种类。用于传感器的光纤的光学特性在一个纤维弯曲实验中第一次获得并且与在示波器中检测到的各种各样的传播特性比如振幅、相移等相关联。实验在使用光纤来用来做负荷传感器的情况下进行。实验结果也体现了当传统传感器不能捕捉精确的的数据时使用光纤纤维网络来传递数据的好处。于是我们试图找到使用车辆的重量进行车辆检测并且克服在军事战争中用来检测车辆传感器的错误的可能性。</p>
<h4 id="文章结构"><a href="#文章结构" class="headerlink" title="文章结构"></a>文章结构</h4><ul>
<li>一 介绍</li>
<li>二 系统需要和工作</li>
<li>三 结果和结论</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/24/Android源码设计模式解析与实战----状态模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ke Yu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coco">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/24/Android源码设计模式解析与实战----状态模式/" itemprop="url">Android源码设计模式解析与实战----状态模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-24T13:21:34+08:00">
                2017-10-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><pre><code>多个对象都可以处理同一个请求，但具体由哪个对象处理则在运行时动态处理。
</code></pre><h3 id="Android源码解析"><a href="#Android源码解析" class="headerlink" title="Android源码解析"></a>Android源码解析</h3><pre><code>常说的View的分发机制，就是使用了责任链模式。一层一层的往下找处理事件的目标，当onTouchEvent返回false的时候，就代表这个view不是目标，不处理这个事件。
</code></pre><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><pre><code>通过有序的BroadcastReceiver可以实现全局责任链模式。因为有序广播可以决定消息是否继续传下去。
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/24/handler解析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ke Yu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coco">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/24/handler解析/" itemprop="url">Handler解析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-24T15:23:42+08:00">
                2017-09-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>主要为了解决不能在UI线程更新控件的问题。</p>
<p>由于Handler运行在主线程中(UI线程中)，  它与子线程可以通过Message对象来传递数据， 这个时候，Handler就承担着接受子线程传过来的(子线程用sendMessage()方法传递Message对象，里面包含数据)  ， 把这些消息放入主线程队列中，配合主线程进行更新UI。</p>
<h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>handler可以分发Message对象和Runnable对象到主线程中， 每个Handler实例，都会绑定到创建他的线程中(一般是位于主线程)，它有两个作用：</p>
<p>(1)安排消息或Runnable在某个主线程中某个地方执行；</p>
<p>post类方法允许你排列一个Runnable对象到主线程队列中</p>
<p>sendMessage类方法， 允许你安排一个带数据的Message对象到队列中，等待更新。</p>
<p>(2）将一个任务放入队列，以便它可以在另外的线程中执行。</p>
<p><img src="handler" alt="http://ovwunej09.bkt.clouddn.com/handler.png"></p>
<h3 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h3><h6 id="A-Handler"><a href="#A-Handler" class="headerlink" title="A.Handler"></a>A.Handler</h6><p>1）几个构造函数，最终主要是两个：</p>
<p>a.使用传入的looper</p>
<p>public Handler(Looper looper, Callback callback, boolean async) {</p>
<p>​    mLooper = looper;//指定该handler实例所绑定的looper实例</p>
<p>​    mQueue = looper.mQueue;</p>
<p>​    mCallback = callback; //给定回调接口进行消息处理。</p>
<p>​    mAsynchronous = async;</p>
<p>}</p>
<p><strong><strong>思考：looper遍历queue中的Msg ，用msg的target handler进行处理，这是looper 关联handler，那么handler关联looper是什么情况？</strong></strong></p>
<p>b.使用默认的looper. Handler最终的构造函数：（async默认是false）</p>
<p>public Handler(Callback callback, boolean async) {</p>
<p>​    if (FIND_POTENTIAL_LEAKS) {</p>
<p>​        final Class&lt;? extends Handler&gt; klass = getClass();</p>
<p>​        if ((klass.isAnonymousClass() || klass.isMemberClass() || klass.isLocalClass()) &amp;&amp;</p>
<p>​                (klass.getModifiers() &amp; Modifier.STATIC) == 0) {</p>
<p>​            Log.w(TAG, “The following Handler class should be static or leaks might occur: “ +</p>
<p>​                klass.getCanonicalName());</p>
<p>​        }</p>
<p>​    }</p>
<p>​    mLooper = Looper.myLooper(); //静态函数，从sThreadLocal中取出变量</p>
<p>​    if (mLooper == null) {</p>
<p>​        throw new RuntimeException(</p>
<p>​            “Can’t create handler inside thread that has not called Looper.prepare()”);</p>
<p>​    }</p>
<p>​    mQueue = mLooper.mQueue;</p>
<p>​    mCallback = callback;</p>
<p>​    mAsynchronous = async;</p>
<p>}</p>
<p>mLooper的默认值是什么？只有Looper调用了prepare()才会有！</p>
<p>// sThreadLocal.get() will return null unless you’ve called prepare().</p>
<p>static final ThreadLocal<looper> sThreadLocal = new ThreadLocal<looper>();</looper></looper></p>
<p>也就是说，handler在构造前，要先在这个线程中执行Looper.prepare()，使Looper.myLooper()能成功返回当前线程threadLocal的looper！</p>
<p>也就是说handler关联looper，是一开始在构造函数中就关联起来的了，handler构造时，要么传入一个存在了的looper（looper.prepare()创造），要么当前线程已经调用looper.prepare()</p>
<p>终究就是要先有Looper.prepare()</p>
<p>2）所有的常用的send和post方法，最终调用的都是sendMessageAtTime(Message, long) 这个方法（如果传入的参数是runnable的话，会先调用getPostMessage(Runnable) 或getPostMessage(Runnable, Object)方法获取消息）</p>
<p>假设看看postDelayed：</p>
<p>A.public final boolean postDelayed(Runnable r, long delayMillis)</p>
<p>{</p>
<p>​    return sendMessageDelayed(getPostMessage(r), delayMillis);—&gt;B</p>
<p>}</p>
<p>其中get函数用来设置runnable依附的message</p>
<p>private static Message getPostMessage(Runnable r) {</p>
<p>​    Message m = Message.obtain();</p>
<p>​    m.callback = r;</p>
<p>​    return m;</p>
<p>}</p>
<p>B.public final boolean sendMessageDelayed(Message msg, long delayMillis)</p>
<p>{</p>
<p>​    if (delayMillis &lt; 0) {</p>
<p>​        delayMillis = 0;</p>
<p>​    }</p>
<p>​    return sendMessageAtTime(msg, SystemClock.uptimeMillis() + delayMillis);—&gt;C</p>
<p>}</p>
<p>重点函数：</p>
<p>// 将message入队，并在指定时间到之前将该消息放在所有挂起的消息之后。</p>
<p>C.public boolean sendMessageAtTime(Message msg, long uptimeMillis) {</p>
<p>​        MessageQueue queue = mQueue;</p>
<p>​        if (queue == null) {</p>
<p>​            RuntimeException e = new RuntimeException(</p>
<p>​                    this + “ sendMessageAtTime() called with no mQueue”);</p>
<p>​            Log.w(“Looper”, e.getMessage(), e);</p>
<p>​            return false;</p>
<p>​        }</p>
<p>​        return enqueueMessage(queue, msg, uptimeMillis);</p>
<p>​    }</p>
<p>private boolean enqueueMessage(MessageQueue queue, Message msg, long uptimeMillis) {</p>
<p>​    msg.target = this; //为message指定target为该handler实例（精髓）</p>
<p>​    if (mAsynchronous) {</p>
<p>​        msg.setAsynchronous(true);</p>
<p>​    }</p>
<p>​    return queue.enqueueMessage(msg, uptimeMillis);</p>
<p>}</p>
<p>PS: 发现了两个强行插队，让runnable在message 的下一个Loop直接执行的函数：</p>
<p>其实就是把delaymills置为0= =</p>
<p>public final boolean postAtFrontOfQueue(Runnable r)</p>
<p>{</p>
<p>​    return sendMessageAtFrontOfQueue(getPostMessage(r));</p>
<p>}</p>
<p>public final boolean sendMessageAtFrontOfQueue(Message msg) {</p>
<p>​    MessageQueue queue = mQueue;</p>
<p>​    if (queue == null) {</p>
<p>​        RuntimeException e = new RuntimeException(</p>
<p>​            this + “ sendMessageAtTime() called with no mQueue”);</p>
<p>​        Log.w(“Looper”, e.getMessage(), e);</p>
<p>​        return false;</p>
<p>​    }</p>
<p>​    return enqueueMessage(queue, msg, 0);</p>
<p>}</p>
<p>D. loop()函数中，msg.target调用的函数：</p>
<p>执行优先级：1)msg中含有callback（用post方法时），用message的这个callback方法处理msg；2）构造这个handler时传入了callback，同样用callback处理Msg；3）直接用handler的重载函数handleMessage处理msg</p>
<p>/**</p>
<p> * Handle system messages here.</p>
<p> */</p>
<p>public void dispatchMessage(Message msg) {</p>
<p>​    if (msg.callback != null) {</p>
<p>​        handleCallback(msg);</p>
<p>​    } else {</p>
<p>​        if (mCallback != null) {</p>
<p>​            if (mCallback.handleMessage(msg)) {</p>
<p>​                return;</p>
<p>​            }</p>
<p>​        }</p>
<p>​        handleMessage(msg);</p>
<p>​    }</p>
<p>}</p>
<p>######B.Message</p>
<p>extends Object</p>
<p>implements Parcelable</p>
<p>一个message对象包含一个自身的描述信息和一个可以发给handler的任意数据对象。</p>
<p>虽然Message的构造方法是public的，但实例化Message的最好方法是调用Message.obtain() 或 Handler.obtainMessage() ，因为这两个方法是从一个可回收利用的message对象回收池中获取Message实例（实际上最终调用的仍然是Message.obtain()）。该回收池用于将每次交给handler处理的message对象进行回收。 </p>
<h5 id="C-MessageQueue"><a href="#C-MessageQueue" class="headerlink" title="C.MessageQueue"></a>C.MessageQueue</h5><p>MessageQueue是用来存放Message的集合，并由Looper实例来分发里面的Message对象。同时，message并不是直接加入到MessageQueue中的, 而是通过与Looper对象相关联的MessageQueue.IdleHandler 对象来完成的。我们可以通过Looper.myQueue() 方法来获得当前线程的MessageQueue。 </p>
<p>MQ实际上没有采用队列，而是采用单链表的数据结构来存储消息列表。</p>
<h5 id="D-Looper"><a href="#D-Looper" class="headerlink" title="D.Looper"></a>D.Looper</h5><p>Looper是线程用来运行消息循环(message loop)的类。默认情况下，线程并没有与之关联的Looper，可以通过在线程中调用Looper.prepare() 方法来获取，用来执行loop，并通过Looper.loop() 无限循环地获取并分发MessageQueue中的消息，直到所有消息全部处理。</p>
<p>* </p><p>This is a typical example of the implementation of a Looper thread,</p>
<p>* using the separation of {@link #prepare} and {@link #loop} to create an</p>
<p>* initial Handler to communicate with the Looper.</p>
<p>*</p>
<p>* <pre></pre></p>
<p>*  class LooperThread extends Thread {</p>
<p>*      public Handler mHandler;</p>
<p>*</p>
<p>*      public void run() {</p>
<p>*          Looper.prepare(); // 创建一个looper，来循坏获取处理MessageQueue里面的消息</p>
<p>*</p>
<p>*          mHandler = new Handler() { // 那么这个handler，就不是在主线程处理msg了，而是在looperThread上处理</p>
<p>*              public void handleMessage(Message msg) {</p>
<p>*                  // process incoming messages here</p>
<p>*              }</p>
<p>*          };</p>
<p>*</p>
<p>*          Looper.loop();  // 处理messagequeue的关键函数</p>
<p>*      }</p>
<p>*  }</p>
<p>1）public static void prepare() {</p>
<p>​    prepare(true);</p>
<p>}</p>
<p>private static void prepare(boolean quitAllowed) { // quitAllowed：是否允许调用quit()函数</p>
<p>​    if (sThreadLocal.get() != null) {</p>
<p>​        throw new RuntimeException(“Only one Looper may be created per thread”);</p>
<p>​    }</p>
<p>​    sThreadLocal.set(new Looper(quitAllowed));</p>
<p>}</p>
<p>可以看到，调用prepare()方法时，会执行prepare(boolean quitAllowed) 方法，其中得先判断sThreadLocal是否为空，不为空才将新建的Looper实例放进sThreadLocal对象中。那么这个sThreadLocal是什么呢？它是一个本地线程存储类，所有线程共享这个对象，但是这个对象对每一个线程而言却具有不同的值，且每个线程对这个对象的访问或修改都不会影响到其他线程，即它的值对于每个线程来说都是独立的。 不同线程的Looper相互独立，之所以能做到这一点，就是借助ThreadLocal来实现的。</p>
<p>sThreadLocal.set(new Looper(quitAllowed))则是把一个新建的Looper实例放进sThreadLocal对象中，而Looper的构造函数内部实现如下,创建一个新的MessageQueue对象并绑定当前线程:</p>
<p>private Looper(boolean quitAllowed) {</p>
<p>​    mQueue = new MessageQueue(quitAllowed);</p>
<p>​    mThread = Thread.currentThread();// 这个mThread在Looper类中毫无用处….</p>
<p>}</p>
<p>2）public static void loop() {}代码很长</p>
<p>public static void loop() {</p>
<p>​    final Looper me = myLooper(); —-&gt;  A. 从threadLocal.get()取looper</p>
<p>​    if (me == null) {</p>
<p>​        throw new RuntimeException(“No Looper; Looper.prepare() wasn’t called on this thread.”);</p>
<p>​    }</p>
<p>​    final MessageQueue queue = me.mQueue;</p>
<p>​    // Make sure the identity of this thread is that of the local process,</p>
<p>​    // and keep track of what that identity token actually is.</p>
<p>​    Binder.clearCallingIdentity();</p>
<p>​    final long ident = Binder.clearCallingIdentity();</p>
<p>​    for (;;) {</p>
<p>​        Message msg = queue.next(); // might block</p>
<p>​        if (msg == null) {</p>
<p>​            // No message indicates that the message queue is quitting.</p>
<p>​            return;</p>
<p>​        }</p>
<p>​        // This must be in a local variable, in case a UI event sets the logger</p>
<p>​        final Printer logging = me.mLogging;</p>
<p>​        if (logging != null) {</p>
<p>​            logging.println(“&gt;&gt;&gt;&gt;&gt; Dispatching to “ + msg.target + “ “ +</p>
<p>​                    msg.callback + “: “ + msg.what);</p>
<p>​        }</p>
<p>​        final long traceTag = me.mTraceTag;</p>
<p>​        if (traceTag != 0 &amp;&amp; Trace.isTagEnabled(traceTag)) {</p>
<p>​            Trace.traceBegin(traceTag, msg.target.getTraceName(msg));</p>
<p>​        }</p>
<p>​        try {</p>
<p>​            msg.target.dispatchMessage(msg); // handler不断把msg入队，这里从队列取出msg，然后用msg的handler进行消息处理</p>
<p>​        } finally {</p>
<p>​            if (traceTag != 0) {</p>
<p>​                Trace.traceEnd(traceTag);</p>
<p>​            }</p>
<p>​        }</p>
<p>​        if (logging != null) {</p>
<p>​            logging.println(“&lt;&lt;&lt;&lt;&lt; Finished to “ + msg.target + “ “ + msg.callback);</p>
<p>​        }</p>
<p>​        // Make sure that during the course of dispatching the</p>
<p>​        // identity of the thread wasn’t corrupted.</p>
<p>​        final long newIdent = Binder.clearCallingIdentity();</p>
<p>​        if (ident != newIdent) {</p>
<p>​            Log.wtf(TAG, “Thread identity changed from 0x”</p>
<p>​                    + Long.toHexString(ident) + “ to 0x”</p>
<p>​                    + Long.toHexString(newIdent) + “ while dispatching to “</p>
<p>​                    + msg.target.getClass().getName() + “ “</p>
<p>​                    + msg.callback + “ what=” + msg.what);</p>
<p>​        }</p>
<p>​        msg.recycleUnchecked();</p>
<p>​    }</p>
<p>}</p>
<p>这个方法，主要是通过myLooper()获取当前线程的Looper实例，如果这个实例存在，就取出这个looper的MQ，然后通过一个死循环，不断的调用queue.next();取出message，如果msg没有target（想想enqueueMessage里面为msg指定了target），就退出循环。</p>
<p>如果有target:msg.target.dispatchMessage(msg);</p>
<p>把真正的处理工作交给msg的target，即对应的handler，直到队列为空。</p>
<p>该函数在每次msg的循环的最后都会调用msg.recycle();回收msg资源。</p>
<p>A.public static @Nullable Looper myLooper() {</p>
<p>​    return sThreadLocal.get();</p>
<p>}</p>
<p>3）Message next() {} 代码也很长，不贴了。</p>
<p>主要功能就是：取出单链表的头节点，对相应指针进行操作，最后返回这个头节点。</p>
<h3 id="灵魂拷问"><a href="#灵魂拷问" class="headerlink" title="灵魂拷问"></a>灵魂拷问</h3><p><strong>思考一：loop() 这里采用的是无限循环，该循环会不会特别消耗CPU资源？？</strong></p>
<p>其实并不会，如果MQ里面有消息，next（）自然能不停的取到msg去交给handler进行处理，如果取不到，那么在nex()的nativePollOnce(ptr, nextPollTimeoutMillis);  就会阻塞该线程，主线程会释放CPU资源进入休眠状态，当有下一个工作到来时，才通过往pipe管道写端写入数据来唤醒主线程工作。这里涉及到的是Linux的pipe/epoll机制，epoll机制是一种IO多路复用机制，可以同时监控多个描述符，当某个描述符就绪(读或写就绪)，则立刻通知相应程序进行读或写操作，本质同步I/O，即读写是阻塞的。所以说，主线程大多数时候都是处于休眠状态，并不会消耗大量CPU资源。</p>
<p>4）public void dispatchMessage(Message msg) {</p>
<p>​    if (msg.callback != null) {</p>
<p>​        handleCallback(msg); ①</p>
<p>​    } else {</p>
<p>​        if (mCallback != null) {</p>
<p>​            if (mCallback.handleMessage(msg)) {②</p>
<p>​                return;</p>
<p>​            }</p>
<p>​        }</p>
<p>​        handleMessage(msg);③</p>
<p>​    }</p>
<p>}</p>
<p>…</p>
<p>① private static void handleCallback(Message message) {</p>
<p>​    message.callback.run();</p>
<p>}</p>
<p>这里我们可以看到，在分发消息时三个方法的优先级分别如下：</p>
<p>①Message的回调方法优先级最高，即message.callback.run()；</p>
<p>②Handler的回调方法优先级次之，即Handler.mCallback.handleMessage(msg)；</p>
<p>③Handler的默认方法优先级最低，即Handler.handleMessage(msg)</p>
<p><strong>思考二、为什么looper.loop()要使用死循环？</strong></p>
<p>对于线程既然是一段可执行的代码，当可执行代码执行完成后，线程生命周期便该终止了，线程退出。而对于主线程，我们是绝不希望会被运行一段时间，自己就退出，那么如何保证能一直存活呢？简单做法就是可执行代码是能一直执行下去的，死循环便能保证不会被退出，例如，binder线程也是采用死循环的方法，通过循环方式不同与Binder驱动进行读写操作，当然并非简单地死循环，无消息时会休眠。但这里可能又引发了另一个问题，既然是死循环又如何去处理其他事务呢？通过创建新线程的方式。</p>
<p><strong>思考三、哪里为Looper.loop（)创建了新线程？</strong></p>
<p>在代码ActivityThread.main()中：</p>
<p>public static void main(String[] args) {</p>
<p>​    Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, “ActivityThreadMain”);</p>
<p>​    SamplingProfilerIntegration.start();</p>
<p>​    // CloseGuard defaults to true and can be quite spammy.  We</p>
<p>​    // disable it here, but selectively enable it later (via</p>
<p>​    // StrictMode) on debug builds, but using DropBox, not logs.</p>
<p>​    CloseGuard.setEnabled(false);</p>
<p>​    Environment.initForCurrentUser();</p>
<p>​    // Set the reporter for event logging in libcore</p>
<p>​    EventLogger.setReporter(new EventLoggingReporter());</p>
<p>​    // Make sure TrustedCertificateStore looks in the right place for CA certificates</p>
<p>​    final File configDir = Environment.getUserConfigDirectory(UserHandle.myUserId());</p>
<p>​    TrustedCertificateStore.setDefaultUserDirectory(configDir);</p>
<p>​    Process.setArgV0(“<pre-initialized>“);</pre-initialized></p>
<p>​    //创建Looper和MessageQueue对象，用于处理主线程的消息</p>
<p>​    Looper.prepareMainLooper();—–&gt;A</p>
<p>​    // 创建ActivityThread对象</p>
<p>​    ActivityThread thread = new ActivityThread();</p>
<p>​    //建立Binder通道 (创建新线程)</p>
<p>​    thread.attach(false);</p>
<p>​    if (sMainThreadHandler == null) {</p>
<p>​        sMainThreadHandler = thread.getHandler();</p>
<p>​    }</p>
<p>​    if (false) {</p>
<p>​        Looper.myLooper().setMessageLogging(new</p>
<p>​                LogPrinter(Log.DEBUG, “ActivityThread”));</p>
<p>​    }</p>
<p>​    // End of event ActivityThreadMain.</p>
<p>​    Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);</p>
<p>​    Looper.loop();</p>
<p>​    throw new RuntimeException(“Main thread loop unexpectedly exited”);</p>
<p>}</p>
<p>A.我们自己不能调用这个function，如果调用了的话- -会 怎么样呢 ？？</p>
<p>/**</p>
<p> * Initialize the current thread as a looper, marking it as an</p>
<p> * application’s main looper. The main looper for your application</p>
<p> * is created by the Android environment, so you should never need</p>
<p> * to call this function yourself.  See also: {@link #prepare()}</p>
<p> */</p>
<p>public static void prepareMainLooper() {</p>
<p>​    prepare(false);</p>
<p>​    synchronized (Looper.class) {</p>
<p>​        if (sMainLooper != null) {</p>
<p>​            throw new IllegalStateException(“The main Looper has already been prepared.”);</p>
<p>​        }</p>
<p>​        sMainLooper = myLooper();</p>
<p>​    }</p>
<p>}</p>
<p>thread.attach(false)；便会创建一个Binder线程（具体是指ApplicationThread，Binder的服务端，用于接收系统服务AMS发送来的事件），该Binder线程通过Handler将Message发送给主线程。</p>
<p>ActivityThread实际上并非线程，不像HandlerThread类，ActivityThread并没有真正继承Thread类，只是往往运行在主线程，该人以线程的感觉，其实承载ActivityThread的主线程就是由Zygote fork而创建的进程。</p>
<p><strong>思考四、最后，扩展到Activity的生命周期。Activity的生命周期是怎么实现在死循环体外能够执行起来的？</strong></p>
<p>ActivityThread的内部类H继承于Handler，通过handler消息机制，简单说Handler机制用于同一个进程的线程间通信。Activity的生命周期都是依靠主线程的Looper.loop，当收到不同Message时则采用相应措施：</p>
<p>在H.handleMessage(msg)方法中，根据接收到不同的msg，执行相应的生命周期。</p>
<p>比如收到msg=H.LAUNCH_ACTIVITY，则调用ActivityThread.handleLaunchActivity()方法，最终会通过反射机制，创建Activity实例，然后再执行Activity.onCreate()等方法；  </p>
<p>再比如收到msg=H.PAUSE_ACTIVITY，则调用ActivityThread.handlePauseActivity()方法，最终会执行Activity.onPause()等方法。</p>
<p>主线程的消息又是哪来的呢？当然是App进程中的其他线程通过Handler发送给主线程，</p>
<p><strong>思考五、handler怎么进行线程切换的？</strong></p>
<p>Handler类的介绍写了：在自己的子线程中，调用post或者sendMessage函数，最后都是调用sendMessageAtTime函数，反正就是把message（post的runnalble 会经过包装，成为message）放到queue中让looper循环获取。</p>
<p>You can create your own threads, and communicate back with</p>
<p>* the main application thread through a Handler.  This is done by calling</p>
<p>* the same <em>post</em> or <em>sendMessage</em> methods as before, but from</p>
<p>* your new thread. </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/11/RxJava/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ke Yu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coco">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/11/RxJava/" itemprop="url">RxJAVA初步理解(1)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-11T23:29:17+08:00">
                2017-09-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>RxJAVA</strong></p>
<p>① subscribe函数：</p>
<p>调用了observable.onSubscribe.call(subscriber)<br>observable:最后一个变换后的observable<br>onSubscribe创建最后一个observable时传入的参数<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SchedulerSupport</span>(SchedulerSupport.NONE)</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(Observer&lt;? <span class="keyword">super</span> T&gt; observer)</span> </span>&#123;</span><br><span class="line">	ObjectHelper.requireNonNull(observer, <span class="string">"observer is null"</span>);</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	<span class="comment">// onXXXX相关的，和刚才的onAssembly是一个套路，同样的使用了Hook</span></span><br><span class="line">		observer = RxJavaPlugins.onSubscribe(<span class="keyword">this</span>, observer);</span><br><span class="line">		ObjectHelper.requireNonNull(observer, <span class="string">"Plugin returned null Observer"</span>);</span><br><span class="line">		<span class="comment">//开始订阅，这个subscribeActual函数，作为onAssembly()的参数时的类，都有重写，</span></span><br><span class="line">		subscribeActual(observer);-----&gt; <span class="number">2</span>A</span><br><span class="line">	&#125; <span class="keyword">catch</span> (NullPointerException e) &#123; <span class="comment">// NOPMD</span></span><br><span class="line">		<span class="keyword">throw</span> e;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Throwable e) &#123;Exceptions.throwIfFatal(e);</span><br><span class="line">		<span class="comment">// can't call onError because no way to know if a Disposable has been set or not can't call onSubscribe because the call might have set a Subscription</span></span><br><span class="line">		already RxJavaPlugins.onError(e);</span><br><span class="line">		NullPointerException npe = <span class="keyword">new</span> NullPointerException(<span class="string">"Actually not, but can't throw other exceptions due to RS"</span>);</span><br><span class="line">			npe.initCause(e);</span><br><span class="line">			<span class="keyword">throw</span> npe;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>②create函数<br>onJust：<br>A.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SchedulerSupport</span>(SchedulerSupport.NONE)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Observable&lt;T&gt; <span class="title">just</span><span class="params">(T item)</span> </span>&#123;</span><br><span class="line">	ObjectHelper.requireNonNull(item, <span class="string">"The item is null"</span>);</span><br><span class="line">	<span class="keyword">return</span> RxJavaPlugins.onAssembly(<span class="keyword">new</span> ObservableJust&lt;T&gt;(item));----&gt;B</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>B.</strong><br>所有onXXXX的函数，都是hook function.<br>onAssembly这个函数：把传进来的各种new<br>ObservableXXX<t>转换为Observable<t></t></t></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Calls the associated hook function.</span><br><span class="line"><span class="comment">/* @param &lt;T&gt; the value type</span></span><br><span class="line"><span class="comment">   @param source the hook's input value</span></span><br><span class="line"><span class="comment">   @return the value returned by the hook</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(&#123; <span class="string">"rawtypes"</span>, <span class="string">"unchecked"</span> &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Observable&lt;T&gt; <span class="title">onAssembly</span><span class="params">(Observable&lt;T&gt; source)</span> </span>&#123;</span><br><span class="line">	Function&lt;Observable, Observable&gt; f = onObservableAssembly; <span class="comment">// 初始值是null</span></span><br><span class="line">	<span class="keyword">if</span> (f != <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> apply(f,source); ---\&gt;C,函数f是源码自带的onObservableAssembly</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> source;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>C.</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Wraps the call to the function in try-catch and propagates thrown checked exceptions as RuntimeException.</span></span><br><span class="line"><span class="comment">@param &lt;T&gt; the input type</span></span><br><span class="line"><span class="comment">@param &lt;R&gt; the output type</span></span><br><span class="line"><span class="comment">@param f the function to call, not null (not verified)</span></span><br><span class="line"><span class="comment">@param t the parameter value to the function</span></span><br><span class="line"><span class="comment">@return the result of the function call</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">static &lt;T, R&gt; R apply(Function&lt;T, R&gt; f, T t) &#123;</span></span><br><span class="line"><span class="comment">	try &#123;</span></span><br><span class="line"><span class="comment">		return f.apply(t); ---&gt;D，自带的函数f进行apply</span></span><br><span class="line"><span class="comment">	&#125; catch (Throwable ex) &#123;</span></span><br><span class="line"><span class="comment">		throw ExceptionHelper.wrapOrThrow(ex);</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>D.</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* A functional interface that takes a value and returns another value, possibly with a different type and allows throwing a checked exception.</span></span><br><span class="line"><span class="comment">@param &lt;T&gt; the input value type</span></span><br><span class="line"><span class="comment">@param &lt;R&gt; the output value type</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">public interface Function&lt;T, R&gt; &#123;</span></span><br><span class="line"><span class="comment">/* Apply some calculation to the input value and return some other value.*/</span></span><br><span class="line">	<span class="meta">@param</span> t the input value</span><br><span class="line">	<span class="meta">@return</span> the output value</span><br><span class="line">	<span class="meta">@throws</span> Exception on error</span><br><span class="line">	</span><br><span class="line">	<span class="function">R <span class="title">apply</span><span class="params">(T t)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>E.subscribeOn:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@param</span> scheduler the &#123;<span class="meta">@link</span> Scheduler&#125; to perform subscription actions on</span><br><span class="line"><span class="meta">@return</span> the source ObservableSource modified so that its subscriptions happen on the specified &#123;<span class="meta">@link</span> Scheduler&#125;</span><br><span class="line">@see &lt;a href="http://reactivex.io/documentation/operators/subscribeon.html"&gt;ReactiveX operators documentation: SubscribeOn&lt;/a&gt;</span><br><span class="line">@see &lt;a href="http://www.grahamlea.com/2014/07/rxjava-threading-examples/"&gt;RxJava Threading Examples&lt;/a&gt;</span><br><span class="line">@see #observeOn</span><br><span class="line"><span class="meta">@SchedulerSupport</span>(SchedulerSupport.CUSTOM)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Observable&lt;T&gt; <span class="title">subscribeOn</span><span class="params">(Scheduler scheduler)</span> </span>&#123;</span><br><span class="line">	ObjectHelper.requireNonNull(scheduler, <span class="string">"scheduler is null"</span>);</span><br><span class="line">		<span class="keyword">return</span> RxJavaPlugins.onAssembly(<span class="keyword">new</span> ObservableSubscribeOn&lt;T&gt;(<span class="keyword">this</span>,scheduler));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>onAssembly就是刚才分析的那个，把当前的observable和scheduler整合，并且以observable<t>的形式返回。</t></p>
<p><strong>F.</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@param</span> &lt;R&gt; the value type of the inner ObservableSources and the output type</span><br><span class="line"><span class="meta">@param</span> mapper a function that, when applied to an item emitted by the source</span><br><span class="line">ObservableSource, returns an ObservableSource</span><br><span class="line"><span class="meta">@return</span> an Observable that emits the result of applying the transformation function to each item emitted by the source ObservableSource and merging the results of the</span><br><span class="line">ObservableSources obtained from <span class="keyword">this</span> transformation</span><br><span class="line">@see &lt;a href="http://reactivex.io/documentation/operators/flatmap.html"\&gt;ReactiveX operators documentation: FlatMap&lt;/a&gt;</span><br><span class="line"><span class="meta">@SchedulerSupport</span>(SchedulerSupport.NONE)</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> &lt;R&gt; <span class="function">Observable&lt;R&gt; <span class="title">flatMap</span><span class="params">(Function&lt;? <span class="keyword">super</span></span></span></span><br><span class="line"><span class="function"><span class="params">T, ? extends ObservableSource&lt;? extends R&gt;&gt; mapper)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> flatMap(mapper, <span class="keyword">false</span>); ----&gt; G</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>G.</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SchedulerSupport</span>(SchedulerSupport.NONE)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> &lt;R&gt; <span class="function">Observable&lt;R&gt; <span class="title">flatMap</span><span class="params">(Function&lt;? <span class="keyword">super</span> T, ? extends ObservableSource&lt;? extends R&gt;&gt; mapper, <span class="keyword">boolean</span> delayErrors, <span class="keyword">int</span> maxConcurrency, <span class="keyword">int</span> bufferSize)</span> </span>&#123;</span><br><span class="line">	ObjectHelper.requireNonNull(mapper, <span class="string">"mapper is null"</span>);</span><br><span class="line">	ObjectHelper.verifyPositive(maxConcurrency, <span class="string">"maxConcurrency"</span>);</span><br><span class="line">	ObjectHelper.verifyPositive(bufferSize, <span class="string">"bufferSize"</span>);</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">this</span> <span class="keyword">instanceof</span> ScalarCallable) &#123;</span><br><span class="line">		<span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">		T v = ((ScalarCallable&lt;T&gt;)<span class="keyword">this</span>).call(); ----&gt;<span class="keyword">this</span>可能会重写call函数（这不就是flatmap实际使用时重写的call函数吗....(lambda传入的那个函数）</span><br><span class="line">		<span class="keyword">if</span> (v == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> empty(); ---&gt; H</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> ObservableScalarXMap.scalarXMap(v,mapper); ---&gt; I</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> RxJavaPlugins.onAssembly(<span class="keyword">new</span> ObservableFlatMap&lt;T, R&gt;(<span class="keyword">this</span>, mapper, delayErrors, maxConcurrency, bufferSize));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>H.</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@param</span> &lt;T&gt; <span class="function">the type of the <span class="title">items</span> <span class="params">(ostensibly)</span> emitted by the ObservableSource</span></span><br><span class="line"><span class="function">@return an Observable that emits no items to the </span>&#123;\<span class="meta">@link</span> Observer&#125; but immediately invokes the &#123;<span class="meta">@link</span> Observer&#125;<span class="string">'s &#123;@link Observer#onComplete() onComplete&#125; method</span></span><br><span class="line"><span class="string">@see &lt;a href="http://reactivex.io/documentation/operators/empty-never-throw.html"&gt;ReactiveX operators documentation: Empty&lt;/a&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@SchedulerSupport(SchedulerSupport.NONE)</span></span><br><span class="line"><span class="string">@SuppressWarnings("unchecked")</span></span><br><span class="line"><span class="string">public static &lt;T&gt; Observable&lt;T&gt; empty() &#123;</span></span><br><span class="line"><span class="string">	return RxJavaPlugins.onAssembly((Observable&lt;T&gt; ObservableEmpty.INSTANCE);</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>I.</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*Maps a scalar value into an Observable and emits its values.*/</span></span><br><span class="line"><span class="meta">@param</span> &lt;T&gt; the scalar value type</span><br><span class="line"><span class="meta">@param</span> &lt;U&gt; the output value type</span><br><span class="line"><span class="meta">@param</span> value the scalar value to map</span><br><span class="line"><span class="meta">@param</span> mapper the function that gets the scalar value and should <span class="keyword">return</span> an ObservableSource that gets streamed</span><br><span class="line"><span class="meta">@return</span> the <span class="keyword">new</span> Observable instance*/</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T, U&gt; <span class="function">Observable&lt;U&gt; <span class="title">scalarXMap</span><span class="params">(T value, Function&lt;? <span class="keyword">super</span> T, ? extends ObservableSource&lt;? extends U&gt;&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">mapper)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> RxJavaPlugins.onAssembly(<span class="keyword">new</span> ScalarXMapObservable&lt;T,</span><br><span class="line">U&gt;(value, mapper));---&gt;J 同样的，<span class="keyword">new</span>一个observable</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>J.</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 把标准值T映射为observableSource，并且订阅他 Maps a scalar value to an ObservableSource and subscribes to it.*/</span></span><br><span class="line"><span class="meta">@param</span> &lt;T&gt; the scalar value type</span><br><span class="line"><span class="meta">@param</span> \&lt;R\&gt; the mapped ObservableSource<span class="string">'s element type.</span></span><br><span class="line"><span class="string">static final class ScalarXMapObservable &lt;T, R&gt; extends</span></span><br><span class="line"><span class="string">Observable&lt;R&gt; &#123;</span></span><br><span class="line"><span class="string">	final T value;</span></span><br><span class="line"><span class="string">	final Function&lt;? super T, ? extends ObservableSource&lt;? extends R&gt;&gt; mapper;</span></span><br><span class="line"><span class="string">	ScalarXMapObservable(T value, Function &lt;? super T, ? extends ObservableSource&lt;? extends R&gt;&gt; mapper) &#123;</span></span><br><span class="line"><span class="string">		this.value = value;</span></span><br><span class="line"><span class="string">		this.mapper = mapper;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>2A.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public final class ObservableCreate&lt;T&gt; extends Observable&lt;T&gt; &#123;&#125;</span><br><span class="line">@Override</span><br><span class="line">protected void subscribeActual(Observer&lt;? super T&gt; observer) &#123;</span><br><span class="line">	//创建发射器，这个observer是我们在应用层自己定义的observer（重写了onNext,onSuccess等函数)</span><br><span class="line">	CreateEmitter&lt;T&gt; parent = new CreateEmitter&lt;T&gt;(observer);</span><br><span class="line">	observer.onSubscribe(parent); // 每个observer都要重写的四个函数之一</span><br><span class="line">	try &#123;</span><br><span class="line">		source.subscribe(parent); // 这个source是每个onXXXX(new ObservableXXX(ffff))中new这个类时传入的参数（其实就是我们在应用层调用create（ffff）时的参数ffff,那么，每个类，比如create的参数类ObservableOnSubscribe&lt;T&gt;，都会重写属于自己的subscribe函数。这样就创建了一个emmiter</span><br><span class="line">	&#125; catch (Throwable ex) &#123;</span><br><span class="line">		Exceptions.throwIfFatal(ex);</span><br><span class="line">		parent.onError(ex);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>K.</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ScalarDisposable</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">AtomicInteger</span></span></span><br><span class="line"><span class="class"><span class="keyword">implements</span> <span class="title">QueueDisposable</span> &lt;<span class="title">T</span>&gt;, <span class="title">Runnable</span> </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ScalarDisposable</span><span class="params">(Observer &lt;? <span class="keyword">super</span> T&gt; observer, T</span></span></span><br><span class="line"><span class="function"><span class="params">value)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.observer = observer;</span><br><span class="line">	<span class="keyword">this</span>.value = value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>L.</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 继承了原子类，又用了CAS = =</span></span><br><span class="line">	<span class="keyword">if</span> (get() == START &amp;&amp; compareAndSet(START, ON_NEXT)) &#123;</span><br><span class="line">		observer.onNext(value);</span><br><span class="line">		<span class="keyword">if</span> (get() == ON_NEXT) &#123;</span><br><span class="line">			lazySet(ON_COMPLETE); </span><br><span class="line">			bserver.onComplete();</span><br><span class="line">		&#125;	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>复习一下原子类<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">lazySet</span><span class="params">(<span class="keyword">int</span> newValue)</span> </span>&#123;</span><br><span class="line">	U.putOrderedInt(<span class="keyword">this</span>, VALUE, newValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>原子类设置值的时候像volatile一样，可以保证其他线程读取到最新的值，这个putOrderedInt其实是volatile的延迟版，也就是其他线程可能在值改变后仍然读到旧值。这有什么好处呢？性能：在多核处理器下，内存以及cpu缓存的读和写常常是顺序执行的，所以在多个cpu缓存之间同步一个内存值的代价是很昂贵的。</p>
<p><strong>2B.</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ScalarDisposable</span><span class="params">(Observer&lt;? <span class="keyword">super</span> T&gt; observer, T</span></span></span><br><span class="line"><span class="function"><span class="params">value)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.observer = observer;</span><br><span class="line">	<span class="keyword">this</span>.value = value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>static final class ScalarXMapObservable&lt;T, R&gt; extends<br>Observable<r> {}</r></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribeActual</span><span class="params">(Observer&lt;? <span class="keyword">super</span> R&gt; s)</span></span>&#123;</span><br><span class="line">ObservableSource&lt;? extends R&gt; other;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		other = ObjectHelper.requireNonNull(mapper.apply(value), <span class="string">"The mapper returned</span></span><br><span class="line"><span class="string">		a null ObservableSource"</span>); <span class="comment">//这个函数mapper就不再是源码自带的，而是我自己传的参数function</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">		EmptyDisposable.error(e, s);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (other <span class="keyword">instanceof</span> Callable) &#123;</span><br><span class="line">		R u;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			u = ((Callable&lt;R&gt;)other).call(); <span class="comment">//调用这个Function的call函数（我们重写的)</span></span><br><span class="line">		&#125; <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">			Exceptions.throwIfFatal(ex);</span><br><span class="line">			EmptyDisposable.error(ex, s);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">if</span> (u == <span class="keyword">null</span>) &#123;</span><br><span class="line">			EmptyDisposable.complete(s);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		ScalarDisposable&lt;R&gt; sd = <span class="keyword">new</span> ScalarDisposable&lt;R&gt;(s,u);---&gt;K</span><br><span class="line">		s.onSubscribe(sd); <span class="comment">//observer都会重写onSubscribe函数（好像也没有...迷）</span></span><br><span class="line">		sd.run(); -----&gt;L</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		other.subscribe(s);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>总结一下几个常用的操作符：</strong><br>总结几个点：</p>
<ul>
<li><p>操作符的参数，就是我们应用层使用时候传入的参数</p>
</li>
<li><p>这个参数，又会被传进各种ObservableXXX的类进行改造（new<br>….），这些类，通常都会进行source （以及value等的存储），这个source，就是<br>subscribeActual中最后 source.subscribe(parent);<br>时的source(parent就是我们subscribe时写的四个函数的包装）</p>
</li>
</ul>
<p><strong>1）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SchedulerSupport</span>(SchedulerSupport.NONE)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Observable&lt;T&gt; <span class="title">create</span><span class="params">(ObservableOnSubscribe&lt;T&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">source)</span> </span>&#123;</span><br><span class="line">	ObjectHelper.requireNonNull(source, <span class="string">"source is null"</span>);</span><br><span class="line">		<span class="keyword">return</span> RxJavaPlugins.onAssembly(<span class="keyword">new</span> ObservableCreate&lt;T&gt;(source));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>2）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SchedulerSupport</span>(SchedulerSupport.NONE)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Observable&lt;T&gt; <span class="title">just</span><span class="params">(T item)</span> </span>&#123;</span><br><span class="line">	ObjectHelper.requireNonNull(item, <span class="string">"The item is null"</span>);</span><br><span class="line">		<span class="keyword">return</span> RxJavaPlugins.onAssembly(<span class="keyword">new</span> ObservableJust&lt;T&gt;(item));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>3）</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SchedulerSupport</span>(SchedulerSupport.CUSTOM)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Observable&lt;T&gt; <span class="title">subscribeOn</span><span class="params">(Scheduler scheduler)</span></span>&#123;</span><br><span class="line">	ObjectHelper.requireNonNull(scheduler, <span class="string">"scheduler is null"</span>);</span><br><span class="line">		<span class="keyword">return</span> RxJavaPlugins.onAssembly(<span class="keyword">new</span> ObservableSubscribeOn&lt;T&gt;(<span class="keyword">this</span>,scheduler));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>4）</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SchedulerSupport</span>(SchedulerSupport.CUSTOM)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Observable&lt;T&gt; <span class="title">observeOn</span><span class="params">(Scheduler scheduler, <span class="keyword">boolean</span></span></span></span><br><span class="line"><span class="function"><span class="params">delayError, <span class="keyword">int</span> bufferSize)</span> </span>&#123;</span><br><span class="line">	ObjectHelper.requireNonNull(scheduler, <span class="string">"scheduler is null"</span>);</span><br><span class="line">	ObjectHelper.verifyPositive(bufferSize, <span class="string">"bufferSize"</span>);</span><br><span class="line">	<span class="keyword">return</span> RxJavaPlugins.onAssembly(<span class="keyword">new</span> ObservableObserveOn&lt;T&gt;(<span class="keyword">this</span>,scheduler, delayError, bufferSize));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>思考一、为什么一定要调用subscribe？</strong></p>
<p><strong>看源码可以看出，</strong><br>observer = RxJavaPlugins.onSubscribe(this,observer);<br><strong>和</strong><br>subscribeActual(observer);<br><strong>这两句</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="Ke Yu" />
            
              <p class="site-author-name" itemprop="name">Ke Yu</p>
              <p class="site-description motion-element" itemprop="description">Keep moving. Don't settle.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">39</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">47</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ke Yu</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
