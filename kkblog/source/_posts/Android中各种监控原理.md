
---
title: Android中监测各种数据的方法
date: 2017-09-07 20:33:24
tags: [Android]
categories: [Android]
---


### 监测内存

    * 监测方法
    Runtime runtime = Runtime.getRuntime();
    通过runtime可以获得当前虚拟机的总内存、使用中内存。

### 监测CPU
    * 监测方法
    1）/proc/cpuinfo ： 读取cpu类型、名字等信息
    2）/sys/devices/system/cpu/ ：读取cpu频率
    3）/proc/stat：读取cpu使用情况（想想学OS时候cpu计算的那些值...)

### 监测FPS

### 监测卡顿
    * 主线程执行的内容：
    UI绘制、系统事件、输入事件、程序回调服务等
    
    * 监测方法：
    1）直接通过连续的FPS帧数计算丢帧率。缺点：FPS刷新频率太快，容易发生抖动。
    
    2）检测主线程消息循坏执行的时间。（想想MainLooper）。如果主线程消息循坏执行时间超过某个阙值T，那么就认为是发生了一次卡顿。
    优化：
    方案①：每一次都进行循环超时检测肯定不太现实，可以考虑检测N次循环时间，看是否超过阙值N*T；
    方案②：以一个时间段为标准，每次卡顿阙值为T，卡顿次数阙值为K次，如果一个时间段里面卡顿次数大于K，那么进行上报。
    
    * 如何定位问题：
    1）抓取发生卡顿时的堆栈，有两个问题：
    ① 何时抓取，当时是要在卡顿发生时抓取
    ② 堆栈怎么归类，和Crash堆栈归类的区别

### 监测流量
    注意这是客户端的流量监测，而不是服务端的流量监测。为什么有两种？
    a.一些网络请求可能无法到达服务端，无法被服务端监测的; b.网络请求都到达了服务端，但是不一定将流量监测结果成功上报。
    
    * 监测方法
    AOP拦截网络请求API（代码没看懂....)
    
    * 如何定位问题
    1）流量来源，API、H5还是CDN
    对于一个只有API请求的客户端来说，当然可以确定来源，但作为一个框架开发，肯定要考虑各种各样的情景。
    一个简单的方法是通过域名来判断，但如果一个域名又有API服务，又有Web服务怎么办呢？
    “检验返回包的MIMEType" 啥意思。
    
    2）网络类型，WIFI,4G,3G，未知


### 监测页面加载速度

    * 监测方法

    加载时间：
    1）测试UI渲染时间
    2）测试网络数据获取时间
    3）页面最后显示出来花的时间
    怎么获得时间呢？
    方法①：在完成相关操作时进行埋点，明显很低效
    方法②：映射每个页面和对应的api，在api请求的基类中埋点
    猜想：通过api获得Activity，从而埋点。
    方法③：hook关键节点上的api调用，注入埋点代码（hook到底是什么鬼意思....)


​    
​    


​    



https://mp.weixin.qq.com/s/MwgjpHj_5RaG74Z0JjNv5g
http://www.jianshu.com/p/d4c3d4f45504