---
title: Tensorflow api整理(4)
date: 2017-11-22 15:16:12
tags: [tensorflow, 机器学习]
categories: [图像]
---




#### tf.app.run()

``` python
"""Generic entry point script."""
from __future__ import absolute_import
from __future__ import division
from __future__ import print_function

import sys

from tensorflow.python.platform import flags


def run(main=None):
  f = flags.FLAGS
  f._parse_flags() --->B
  main = main or sys.modules['__main__'].main
  sys.exit(main(sys.argv))
```

A:
``` python
def _parse_flags(self):  
  result, _ = _global_parser.parse_known_args()  
  for flag_name, val in vars(result).items():  
    self.__dict__['__flags'][flag_name] = val  
  self.__dict__['__parsed'] = True  
```


#### tf.image.random_crop(image, size, seed=None, name=None)

Randomly crops image to size [target_height, target_width].
随机裁剪[target_height,target_width]大小的图片.

The offset of the output within image is uniformly random. image always fully contains the result.

Args:
* image: 3-D tensor of shape [height, width, channels]
  图像源.
* size: 1-D tensor with two elements, specifying target [height, width]
  切割大小.
* seed: A Python integer. Used to create a random seed. See set_random_seed for behavior.
* name: A name for this operation (optional).

Returns:
A cropped 3-D tensor of shape [target_height, target_width, channels].

#### tf.image.random_flip_left_right(image, seed=None)

Randomly flip an image horizontally (left to right).
随机水平裁剪图片。

With a 1 in 2 chance, outputs the contents of image flipped along the second dimension, which is width. Otherwise output the image as-is.

Args:
* image: A 3-D tensor of shape [height, width, channels].
* seed: A Python integer. Used to create a random seed. See set_random_seed for behavior.

Returns:
A 3-D tensor of the same type and shape as image.



#### tf.image.random_brightness(image, max_delta, seed=None)

Adjust the brightness of images by a random factor.
调节明亮度。

Equivalent to adjust_brightness() using a delta randomly picked in the interval [-max_delta, max_delta).

Note that delta is picked as a float. Because for integer type images, the brightness adjusted result is rounded before casting, integer images may have modifications in the range [-max_delta,max_delta].

Args:
* image: 3-D tensor of shape [height, width, channels].
* max_delta: float, must be non-negative.
* seed: A Python integer. Used to create a random seed. See set_random_seed for behavior.

Returns:
3-D tensor of images of shape [height, width, channels]



#### tf.image.random_contrast(image, lower, upper, seed=None)

Adjust the contrase of an image by a random factor.
调节对比度。

Equivalent to adjust_constrast() but uses a contrast_factor randomly picked in the interval [lower, upper].

Args:
* image: 3-D tensor of shape [height, width, channels].
* lower: float. Lower bound for the random contrast factor.
* upper: float. Upper bound for the random contrast factor.
* seed: A Python integer. Used to create a random seed. See set_random_seed for behavior.

Returns:
3-D tensor of shape [height, width, channels].

#### tf.image.per_image_standardization(image)

图片的标准化，可以加速神经网络训练。why?
包含以下步骤：
(x - mean) / adjusted_stddev
x 为RGB三通道像素值，mean为RGB三通道像素均值，其中
adjusted_stddev = max(stddev, 1.0/sqrt(image.NumElements()))
stddev为RGB三通道像素的标准差,image.NumElements为RGB三通道像素的个数


#### tf.cast(x, dtype, name=None)

Casts a tensor to a new type.
将x类型转换为dtype类型。

The operation casts x (in case of Tensor) or x.values (in case of SparseTensor) to dtype.

For example:
```
# tensor `a` is [1.8, 2.2], dtype=tf.float
tf.cast(a, tf.int32) ==> [1, 2]  # dtype=tf.int32
```

Args:
* x: A Tensor or SparseTensor.
* dtype: The destination type.
* name: A name for the operation (optional).
  Returns:

A Tensor or SparseTensor with same shape as x.


#### tf.FixedLengthRecordReader.read(queue, name=None)

Returns the next record (key, value pair) produced by a reader.

Will dequeue a work unit from queue if necessary (e.g. when the Reader needs to start reading from a new file since it has finished with the previous file).
从队列中读取一个unit，以键值对的形式返回。
Args:
* queue: A Queue or a mutable string Tensor representing a handle to a Queue, with string work items.
* name: A name for the operation (optional).

Returns:
A tuple of Tensors (key, value).
* key: A string scalar Tensor.
* value: A string scalar Tensor.


#### tf.decode_raw(bytes, out_type, little_endian=None, name=None)

Reinterpret the bytes of a string as a vector of numbers.
将string重新转换为向量。

Args:
* bytes: A Tensor of type string. All the elements must have the same length.
* out_type: A tf.DType from: tf.float32, tf.float64, tf.int32, tf.uint8, tf.int16, tf.int8, tf.int64.
* little_endian: An optional bool. Defaults to True. Whether the input bytes are in little-endian order. Ignored for out_types that are stored in a single byte like uint8.
* name: A name for the operation (optional).

Returns:
A Tensor of type out_type. A Tensor with one more dimension than the input bytes. The added dimension will have size equal to the length of the elements of bytes divided by the number of bytes to represent out_type.
返回比输入大一维的out_type类型的tensor


#### tf.slice(input_, begin, size, name=None)

Extracts a slice from a tensor.

This operation extracts a slice of size size from a tensor input starting at the location specified by begin. The slice size is represented as a tensor shape, where size[i] is the number of elements of the 'i'th dimension of input that you want to slice. 

在输入的tensor中从位置begin[i]起提出长度为size[i]的片段，size使用tesnsor shape表示，size[i]代表输入的第i维的元素个数.
这个函数稍微有点抽象，可以首先从二维开始想：
input is :
[[1,2,3], [4,5,6], [7,8,9]]
如果begin = [1,1]
size = [2,2]
那么就从[1,1]位置开始，即5的位置开始，截取2行2列的片段，也就是：
[[5,6],[8,9]]

同理在三维情况下，看看这个官方例子：
``` python
# 'input' is [[[1, 1, 1], [2, 2, 2]],
#             [[3, 3, 3], [4, 4, 4]],
#             [[5, 5, 5], [6, 6, 6]]]
tf.slice(input, [1, 0, 0], [1, 1, 3]) ==> [[[3, 3, 3]]]
tf.slice(input, [1, 0, 0], [1, 2, 3]) ==> [[[3, 3, 3],
                                            [4, 4, 4]]]
tf.slice(input, [1, 0, 0], [2, 1, 3]) ==> [[[3, 3, 3]],
                                           [[5, 5, 5]]]
                                        
```

* Ex.1 :
    以[1,0,0]为起点，划分[1,1,3]的大小，1即[[3, 3, 3], [4, 4, 4]]这个数组A的位置，大小为1,那么就是这个数组A本身；0即[3,3,3]这个数组B的位置,大小为1,那么就是这个数组B的位置，0即第一个3这个位置,大小为3,那么就包含从这个3开始的3个数即3,3,3;所以结果为[[[3,3,3]]]

* Ex.2 ：
    以[1,0,0]为起点，划分[1,2,3]的大小，1即[[3, 3, 3], [4, 4, 4]]这个数组A的位置，大小为1,那么就是这个数组A本身；0即[3,3,3]这个数组B的位置,大小为2,那么就是[3,3,3],[4,4,4]两个数组，0即第一个3和第一个4这个位置,大小为3,那么就包含从这个3(4)开始的3个数即3,3,3(4,4,4);所以结果为[[[3,3,3],[4,4,4]]]

    同理Ex.3.

    ​
#### tf.merge_all_summaries(key='summaries') 
(tf.summary.merge_all())

Merges all summaries collected in the default graph.
收集graph中所有的summaries.

Args:
key: GraphKey used to collect the summaries. Defaults to GraphKeys.SUMMARIES.

Returns:
If no summaries were collected, returns None. Otherwise returns a scalar Tensor of typestring containing the serialized Summary protocol buffer resulting from the merging.



#### tf.get_default_graph()
获取默认的图。

#### tf.Graph.as_graph_def
(from_version=None, add_shapes=False)
返回图的序列化表示。

#### tf.summary.FileWriter(FLAGS.eval_dir,graph_def=graph_def)
将运行图得到的summary写到磁盘中。


#### checkpoint_state
```
with tf.Session() as sess:
    ckpt = tf.train.get_checkpoint_state(FLAGS.checkpoint_dir)
    if ckpt and ckpt.model_checkpoint_path:
      # Restores from checkpoint
      saver.restore(sess, ckpt.model_checkpoint_path)
      # Assuming model_checkpoint_path looks something like:
      #   /my-favorite-path/cifar10_train/model.ckpt-0,
      # extract global_step from it.
      global_step = ckpt.model_checkpoint_path.split('/')[-1].split('-')[-1]
    else:
      print('No checkpoint file found')
      return
```

#### tf.get_collection(key, scope=None)

Wrapper for Graph.get_collection() using the default graph.
从图中取出对应Key的所有list values
See Graph.get_collection() for more details.

Args:
* key: The key for the collection. For example, the GraphKeys class contains many standard names for collections.
* scope: (Optional.) If supplied, the resulting list is filtered to include only items whose name begins with this string.

Returns:
The list of values in the collection with the given name, or an empty list if no value has been added to that collection. The list contains the values in the order under which they were collected.
