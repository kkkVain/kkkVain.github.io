---
title: Effective Java 读书笔记（2.2）
date: 2017-06-26 23:02:21
tags: [Effective java, java, 读书笔记]
categories: [Java]
---

第二章 创建和销毁对象

**第2条. 遇到多个构造器参数时要考虑用构造器**

假设某个类，只有几个参数是必须的，其他是可选的，采用什么办法？

* ①一般使用重叠构造器（很多源码里面都是这种方法...)

	比如第一个构造器只用必要参数，第二个构造器增加一个可选参数，第三个构造器又增加一个可选参数...每个参数都调用this(下一个构造器需要的参数)，那么最后一个构造器就可以有所有参数了（一些参数可能来自于this时的默认值）
	
	**但是如果参数很多很多，重叠构造器这种方法显然太繁琐。**

* **②javabean模式，使用无参构造器，用setXXX（）来设置XXX属性。**

	**但缺点也很严重，构造过程被分割了，所以无法保证对象的一致性。阻止了让类不可变的这个规则。这就需要考虑到线程安全。**

	**可以考虑在构造完成前冻结对象，但是实践中很少这么用。**

* **③Buidler模式，既能保证①的安全性，又可以保证②的可读性**

	**首先用必要的参数调用这个类中的静态Builder的构造器方法得到Builder对象，然后通过Builder的set函数进行参数的设置（注意set函数要返回this，链式调用）最后通过.build(this)，通过builder的参数得到这个类的实例对象，这个对象就是不可变的。**

	![clipboard.png](http://ovwunej09.bkt.clouddn.com/EF04.png)

	![clipboard.png](http://ovwunej09.bkt.clouddn.com/EF05.png)

	要构建实例的时候:

	![clipboard.png](http://ovwunej09.bkt.clouddn.com/EF06.png)

#### 优点：

* **a.builder可以对参数进行约束**，调用builde方法时，需要将builder的参数赋值给对象的参数，所以在对象域中，会对参数进行检验，如果违反了约束，build方法就会抛出异常。

* **b.或者在调用set方法时，**就对需要满足该约束条件的所有参数进行检查，如果约束条件没有满足，**set方法就抛出异常，不用等到build方法去抛出异常。**

* c.相比构造器，builder可以有多个可变的参数。

* d.设置了参数的builder生成了一个很好的抽象工厂。

客户端将这样的builder传给方法，方法可以为客户端创建一个或者多个对象。

传统的抽象工厂是class对象用newInstance方法充当build方法的角色，这种方法有以下问题：

* 1）newInstance方法试图调用类的无参构造器，这个构造器可能不存在。编译时不会收到错误，但是客户端运行时会出现异常。

* 2）newInstance没有throws子句，还会传播这个异常

也就是说，class.newInstance破坏了编译时的异常检查，而builder接口弥补了这些不足。

#### 缺点：

* a.要创建对象就要先创建builder，比较消耗性能。一般使用于4个以上或更多的参数。

	如果一开始使用的是构造器或静态工厂，需要增加参数时才使用构建器会让事情变得复杂，所以最好一开始就使用bulder。


#### 总结

类的构造器或者静态工厂中参数比较多时，一般使用builder模式，特别是大多数参数都是可选的时候。相比重叠构造器：更加利于阅读和编写，相比JavaBean：更加安全。